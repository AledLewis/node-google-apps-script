#!/usr/bin/env node
var program = require('commander');
var path = require('path');
var pkg = require('../package.json');
var commands = path.join(__dirname, '../lib/commands');

program
  .version(pkg.version)
  .on('*', function(name) {
    console.log('\''+name+'\' is not a known command.');
    program.outputHelp();
    process.exit(1);
  });

program
  .command('auth <path/to/client/secret.json>')
  .option('-w, --use-webserver [webserver]',
    'Use a local webserver to capture oauth code')
  .option('-p, --port [port]', 'Port to use for webserver')
  .description('Authorize Google API')
  .action(function(clientSecretPath, options) {
    var useWebserver = options.useWebserver !== 'false';
    require(commands + '/auth')(clientSecretPath, useWebserver).then(function() {
      process.exit(0);
    });
  });

program
  .command('init <fileId> [subdir]')
  .description('Initialize blank project. The project must exist, but only contain the defalt Code.gs')
  .alias('project')
  .action(require(commands + '/init'));

program
  .command('download [fileId] [subdir]')
  .description('Download a Google Apps Script project')
  .action(require(commands + '/download'));

program
  .command('upload [subdir]')
  .description('Upload back to Google Drive. Run from root of project directory')
  .alias('push')
  .action(require(commands + '/upload'));

program
  .command('sync [subdir]')
  .description('Downloads manifest from Google Drive')
  .action(require(commands + '/sync'));

program
  .parse(process.argv);

if (program.args.length < 1 ) {
  console.log('No command specified.');
  program.outputHelp();
  process.exit(2);
}
